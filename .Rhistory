]
setnames(dt_eleicoes, "votos_razao", "votos_razao_pp")
# Criar coluna com razão de votos centralizada
dt_eleicoes[, votos_razao_pp_centr := votos_razao_pp - 0.5]
# Criar coluna com razão de votos centralizada ao quadrado
dt_eleicoes[, votos_razao_pp_centr_sq := votos_razao_pp_centr^2]
# Dar uma olhada na base de dados resultante
str(dt_eleicoes)
# # Fazer query
# query <- "
# SELECT
#     dados.id_emenda as id_emenda,
#     dados.ano_emenda as ano_emenda,
#     dados.id_autor_emenda as id_autor_emenda,
#     dados.numero_emenda as numero_emenda,
#     dados.id_municipio_gasto as id_municipio
# FROM `basedosdados.br_cgu_emendas_parlamentares.microdados` AS dados
# WHERE
#     dados.ano_emenda IN (2021)
# "
# de_para_emendas_municipios <- read_sql(query, billing_project_id = "pub-450900")
# setDT(de_para_emendas_municipios)
# rm(query)
#
# # Criar emenda (número/ano) igual à base de emendas do Siga Brasil
# de_para_emendas_municipios[, emenda_numero_ano := paste0(id_autor_emenda,
#                                                          numero_emenda,
#                                                          "-",
#                                                          ano_emenda)]
#
# # Selecionar somente as colunas de de-para
# de_para_emendas_municipios <- de_para_emendas_municipios[, .(emenda_numero_ano, id_autor_emenda, id_municipio)]
#
# # Salvar base de dados resultante
# saveRDS(de_para_emendas_municipios, "Bases de dados/Brasil/BD_id_emenda_municipio.rds")
# Carregar base de dados que relaciona emendas e municípios (por código do IBGE)
de_para_emendas_municipios <- readRDS("Bases de dados/Brasil/BD_id_emenda_municipio.rds")
de_para_emendas_municipios[, id_autor_emenda := NULL]
# Carregar base de dados de emendas parlamentares
dt_emendas <- read_excel("Bases de dados/Brasil/SigaBrasil_emendas.xlsx")
setDT(dt_emendas)
# Renomear colunas
colnames(dt_emendas) <- make_clean_names(colnames(dt_emendas))
# Juntar com informação de códigos IBGE
dt_emendas <- merge(dt_emendas, de_para_emendas_municipios, all.x = T)
rm(de_para_emendas_municipios)
# Substituir id_municipio manualmente para as 4 emendas sem essa informação na base
dt_emendas[emenda_numero_ano == "14510004-2021" , id_municipio := "5002704"]
dt_emendas[emenda_numero_ano == "37390008-2021", id_municipio := "2504009"]
dt_emendas[emenda_numero_ano == "40680005-2021", id_municipio := "1301605"]
# Garantir que não há NAs
colSums(is.na(dt_emendas))
# Renomear coluna de tipo
setnames(dt_emendas, "autor_tipo", "tipo_emenda")
# Resumir dados por município, tipo de emenda, função e GND e armazenar dt para eventuais análises de heterogeneidade
dt_emendas_com_funcao_gnd <- dt_emendas[,
.(valor_empenhado_ipca = sum(empenhado_ipca)),
by = .(id_municipio, tipo_emenda, funcao, gnd_desc)
]
# Resumir dados por município e tipo de emenda
dt_emendas <- dt_emendas[,
.(valor_empenhado_ipca = sum(empenhado_ipca)),
by = .(id_municipio, tipo_emenda)
]
# Ver quais tipos de emendas há na base
dt_emendas[, unique(tipo_emenda)]
# Simplificar nome do tipo de emenda
dt_emendas[, tipo_emenda := fcase(
tipo_emenda == "INDIVIDUAL", "individual",
tipo_emenda == "BANCADA ESTADUAL (RP 7)", "bancada",
tipo_emenda == "RELATOR (RP 9)", "relator"
)]
# Dar uma olhada na base
head(dt_emendas)
# Resumir valor empenhado de emendas por tipo
dt_emendas[, .(valor_empenhado_ipca = sum(valor_empenhado_ipca)), by = tipo_emenda]
# Resumir qtde de municípios que receberam cada tipo de emenda
writeLines(paste0(
"Quantidade de municípios a receberem qualquer tipo de emenda: ", length(dt_emendas[, unique(id_municipio)]),
"\nQuantidade de municípios a receberem emendas individuais: ", length(dt_emendas[tipo_emenda == "individual", unique(id_municipio)]),
"\nQuantidade de municípios a receberem emendas de bancada: ", length(dt_emendas[tipo_emenda == "bancada", unique(id_municipio)]),
"\nQuantidade de municípios a receberem emendas de relator: ", length(dt_emendas[tipo_emenda == "relator", unique(id_municipio)])
))
# Ver se algum município de dt_eleicoes não está em dt_municípios
municipios_dt_eleicoes <- unique(dt_eleicoes[, paste0(id_municipio_nome, sigla_uf)])
municipios_dt_municipios <- unique(dt_municipios[, paste0(id_municipio_nome, sigla_uf)])
for (muni in municipios_dt_eleicoes) {
if (!muni %in% municipios_dt_municipios) {
print(muni)
}
}
rm(municipios_dt_eleicoes, municipios_dt_municipios, muni)
# Renomear municípios de dt_municipios fora do padrão de dt_eleicoes
dt_municipios[id_municipio_nome == "Santa Terezinha" & sigla_uf == "BA",
id_municipio_nome := "Santa Teresinha"]
dt_municipios[id_municipio_nome == "São Tomé das Letras" & sigla_uf == "MG",
id_municipio_nome := "São Thomé das Letras"]
dt_municipios[id_municipio_nome == "São Vicente Férrer" & sigla_uf == "PE",
id_municipio_nome := "São Vicente Ferrer"]
dt_municipios[id_municipio_nome == "Restinga Sêca" & sigla_uf == "RS",
id_municipio_nome := "Restinga Seca"]
dt_municipios[id_municipio_nome == "Vespasiano Corrêa" & sigla_uf == "RS",
id_municipio_nome := "Vespasiano Correa"]
dt_municipios[id_municipio_nome == "Westfália" & sigla_uf == "RS",
id_municipio_nome := "Westfalia"]
dt_municipios[id_municipio_nome == "Grão-Pará" & sigla_uf == "SC",
id_municipio_nome := "Grão Pará"]
dt_municipios[id_municipio_nome == "Lauro Müller" & sigla_uf == "SC",
id_municipio_nome := "Lauro Muller"]
dt_municipios[id_municipio_nome == "São Cristóvão do Sul" & sigla_uf == "SC",
id_municipio_nome := "São Cristovão do Sul"]
dt_municipios[id_municipio_nome == "Amparo do São Francisco" & sigla_uf == "SE",
id_municipio_nome := "Amparo de São Francisco"]
# Repetir procedimento para ver se deu certo
municipios_dt_eleicoes <- unique(dt_eleicoes[, paste0(id_municipio_nome, sigla_uf)])
municipios_dt_municipios <- unique(dt_municipios[, paste0(id_municipio_nome, sigla_uf)])
for (muni in municipios_dt_eleicoes) {
if (!muni %in% municipios_dt_municipios) {
print(muni)
}
}
rm(municipios_dt_eleicoes, municipios_dt_municipios, muni)
# Adicionar dados sobre os municípios com eleições de interesse
dt_municipios_eleicoes <- merge(dt_eleicoes, dt_municipios, all.x = T)
rm(dt_eleicoes, dt_municipios)
# Dar uma olhada na base de dados resultante
str(dt_municipios_eleicoes)
# Verificar se houve algum NA
colSums(is.na(dt_municipios_eleicoes))
# Resumir emendas por id_municipio, independentemente de tipo
dt_emendas_todas <- dt_emendas[,
.(valor_empenhado_ipca = sum(valor_empenhado_ipca)),
by = id_municipio]
# Adicionar dados sobre emendas ao dt_municipios_eleicoes
dt_todas <- merge(dt_municipios_eleicoes, dt_emendas_todas, all.x = T, by = "id_municipio")
rm(dt_emendas_todas)
# Transformar NAs em 0
dt_todas[is.na(valor_empenhado_ipca), valor_empenhado_ipca := 0]
# Adicionar coluna de valor empenhado per capita (usando valor de 2021 e pop de 2022)
dt_todas[, valor_empenhado_ipca_pc := valor_empenhado_ipca/pop]
# Filtrar por somente emendas individuais
dt_emendas_individuais <- dt_emendas[tipo_emenda == "individual"]
# Remover coluna de tipo
dt_emendas_individuais[, tipo_emenda := NULL]
# Adicionar dados sobre emendas ao dt_municipios_eleicoes
dt_individuais <- merge(dt_municipios_eleicoes, dt_emendas_individuais, all.x = T, by = "id_municipio")
rm(dt_emendas_individuais)
# Transformar NAs em 0
dt_individuais[is.na(valor_empenhado_ipca), valor_empenhado_ipca := 0]
# Adicionar coluna de valor empenhado per capita (usando valor de 2021 e pop de 2022)
dt_individuais[, valor_empenhado_ipca_pc := valor_empenhado_ipca/pop]
# Filtrar por somente emendas de bancada
dt_emendas_bancada <- dt_emendas[tipo_emenda == "bancada"]
# Remover coluna de tipo
dt_emendas_bancada[, tipo_emenda := NULL]
# Adicionar dados sobre emendas ao dt_municipios_eleicoes
dt_bancada <- merge(dt_municipios_eleicoes, dt_emendas_bancada, all.x = T, by = "id_municipio")
rm(dt_emendas_bancada)
# Transformar NAs em 0
dt_bancada[is.na(valor_empenhado_ipca), valor_empenhado_ipca := 0]
# Adicionar coluna de valor empenhado per capita (usando valor de 2021 e pop de 2022)
dt_bancada[, valor_empenhado_ipca_pc := valor_empenhado_ipca/pop]
# Filtrar por somente emendas de relator
dt_emendas_relator <- dt_emendas[tipo_emenda == "relator"]
# Remover coluna de tipo
dt_emendas_relator[, tipo_emenda := NULL]
# Adicionar dados sobre emendas ao dt_municipios_eleicoes
dt_relator <- merge(dt_municipios_eleicoes, dt_emendas_relator, all.x = T, by = "id_municipio")
rm(dt_emendas_relator)
# Transformar NAs em 0
dt_relator[is.na(valor_empenhado_ipca), valor_empenhado_ipca := 0]
# Adicionar coluna de valor empenhado per capita (usando valor de 2021 e pop de 2022)
dt_relator[, valor_empenhado_ipca_pc := valor_empenhado_ipca/pop]
rm(dt_emendas)
#| label: grafico_barras_medias_caracteristicas_municipais
# Criar dt com médias
medias <- dt_individuais[
,
.(
media_pop = mean(pop),
media_densidade_demografica = mean(densidade_demografica),
media_PIBpc = mean(PIBpc),
media_taxa_escolarizacao = mean(taxa_escolarizacao),
media_valor_empenhado = mean(valor_empenhado_ipca_pc)
),
by = vitoria_pp
]
# Plotar medianas de quem venceu vs. não venceu - formatar
titulo <- ggplot() +
labs(title = "Comparação das medianas de características municipais", subtitle = "Fontes dos dados: TSE (2021), IBGE (2021, 2022). Elaboração própria.") +
theme_minimal()
g1 <- medias %>%
ggplot(aes(y = media_pop, x = as.factor(vitoria_pp), data = )) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "População",
x = "Prefeito do PP?")
g2 <- medias %>%
ggplot(aes(y = media_densidade_demografica, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Densidade\ndemográfica",
x = "Prefeito do PP?")
g3 <- medias %>%
ggplot(aes(y = media_PIBpc, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "PIB per capita",
x = "Prefeito do PP?")
g4 <- medias %>%
ggplot(aes(y = media_taxa_escolarizacao, x = as.factor(vitoria_pp))) +
geom_col() +
scale_y_continuous(labels = label_percent()) +
theme_minimal() +
labs(title = "",
y = "Taxa de escolarização",
x = "Prefeito do PP?")
g5 <- medias %>%
ggplot(aes(y = media_valor_empenhado, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Valor empenhado per capita",
x = "Prefeito do PP?")
graficos <- plot_grid(g1, g2, g3, g4, g5)
# plot_grid(titulo, graficos, ncol = 1, rel_heights = c(0.15, 1))
graficos
rm(medias, titulo, graficos, g1, g2, g3, g4, g5)
#| label: grafico_caracteristicas_municipais_por_razao_votos_pp
# Linear
g_pop <- dt_todas[pop %between% quantile(pop, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = pop, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "População",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent()) + scale_x_continuous(labels = label_percent())
g_densidade_demografica <- dt_todas[densidade_demografica %between% quantile(densidade_demografica, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = densidade_demografica, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "Densidade\ndemográfica",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent())
g_PIBpc <- dt_todas[PIBpc %between% quantile(PIBpc, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = PIBpc, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "PIB per capita",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent())
g_taxa_escolarizacao <- dt_todas[taxa_escolarizacao %between% quantile(taxa_escolarizacao, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = taxa_escolarizacao, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "Taxa de\nescolarização",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent())
plot_grid(g_pop, g_densidade_demografica, g_PIBpc, g_taxa_escolarizacao, ncol = 2)
# Guardar bases de dados completas
dt_todas_completa <- dt_todas
dt_individuais_completa <- dt_individuais
dt_bancada_completa <- dt_bancada
dt_relator_completa <- dt_relator
# Obter janela ótima para modelo linear com covariadas
covariadas <- dt_individuais[, .(pop, densidade_demografica, PIBpc, taxa_escolarizacao)]
janela <- rdbwselect(
x = dt_individuais$votos_razao_pp_centr,
y = dt_individuais$valor_empenhado_ipca_pc,
p = 1,
covs = covariadas
)
janela$bws
# Filtrar base de dados para municípios cuja margem de vitória do PP está na janela
dt_todas <- dt_todas[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
dt_individuais <- dt_individuais[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
dt_bancada <- dt_bancada[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
dt_relator <- dt_relator[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
# Ver quantos municípios com eleições acirradas receberam emendas
writeLines(paste0(
"Quantidade de municípios com eleições acirradas: ",
nrow(dt_todas),
"\nQuantidade de municípios com eleições acirradas que receberam emendas: ",
nrow(dt_todas[valor_empenhado_ipca != 0]),
"\nQuantidade de municípios com eleições acirradas que receberam emendas individuais: ",
nrow(dt_individuais[valor_empenhado_ipca != 0]),
"\nQuantidade de municípios com eleições acirradas que receberam emendas de bancada: ",
nrow(dt_bancada[valor_empenhado_ipca != 0]),
"\nQuantidade de municípios com eleições acirradas que receberam emendas de relator: ",
nrow(dt_relator[valor_empenhado_ipca != 0])))
# Duas regressões lineares com controles de município
regs_lineares_controles <- lm_robust(valor_empenhado_ipca_pc ~ vitoria_pp*votos_razao_pp_centr + regiao + pop + densidade_demografica + PIBpc + taxa_escolarizacao, data = dt_individuais)
#| label: grafico_valor_empenhado_por_razao_votos_pp_linear_com_controles
# Filtrar base de dados pra região Norte
# Repetir estimação
# Filtrar base de dados pra região Nordeste
# Repetir estimação
# Filtrar base de dados pra região Sudeste
# Repetir estimação
# Filtrar base de dados pra região Sul
# Repetir estimação
# Filtrar base de dados pra região Centro-Oeste
# Repetir estimação
# Recuperação das versões completas das bases de dados
dt_todas <- dt_todas_completa
dt_individuais <- dt_individuais_completa
dt_bancada <- dt_bancada_completa
dt_relator <- dt_relator_completa
# Obter janela ótima para modelo linear sem covariadas
janela <- rdbwselect(
x = dt_individuais$votos_razao_pp_centr,
y = dt_individuais$valor_empenhado_ipca_pc,
p = 1
)
janela$bws
# Filtrar base de dados para municípios cuja margem de vitória do PP está na janela
dt_todas <- dt_todas[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
dt_individuais <- dt_individuais[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
dt_bancada <- dt_bancada[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
dt_relator <- dt_relator[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
# Ver quantos municípios com eleições acirradas receberam emendas
writeLines(paste0(
"Quantidade de municípios com eleições acirradas: ",
nrow(dt_todas),
"\nQuantidade de municípios com eleições acirradas que receberam emendas: ",
nrow(dt_todas[valor_empenhado_ipca != 0]),
"\nQuantidade de municípios com eleições acirradas que receberam emendas individuais: ",
nrow(dt_individuais[valor_empenhado_ipca != 0]),
"\nQuantidade de municípios com eleições acirradas que receberam emendas de bancada: ",
nrow(dt_bancada[valor_empenhado_ipca != 0]),
"\nQuantidade de municípios com eleições acirradas que receberam emendas de relator: ",
nrow(dt_relator[valor_empenhado_ipca != 0])))
# Duas regressões lineares sem controles de município
regs_lineares <- lm_robust(valor_empenhado_ipca_pc ~ vitoria_pp*votos_razao_pp_centr, data = dt_individuais)
#| label: grafico_valor_empenhado_por_razao_votos_pp_linear_sem_controles
# Recuperação das versões completas das bases de dados
dt_todas <- dt_todas_completa
dt_individuais <- dt_individuais_completa
dt_bancada <- dt_bancada_completa
dt_relator <- dt_relator_completa
#| label: grafico_caracteristicas_municipais_por_razao_votos_pp_quad
# Recuperação das versões completas das bases de dados
dt_todas <- dt_todas_completa
dt_individuais <- dt_individuais_completa
dt_bancada <- dt_bancada_completa
dt_relator <- dt_relator_completa
# Linear
g_pop <- dt_todas[pop %between% quantile(pop, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = pop, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F, formula = y ~ poly(x, 2)) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "População",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent()) + scale_x_continuous(labels = label_percent())
g_densidade_demografica <- dt_todas[densidade_demografica %between% quantile(densidade_demografica, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = densidade_demografica, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F, formula = y ~ poly(x, 2)) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "Densidade\ndemográfica",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent())
g_PIBpc <- dt_todas[PIBpc %between% quantile(PIBpc, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = PIBpc, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F, formula = y ~ poly(x, 2)) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "PIB per capita",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent())
g_taxa_escolarizacao <- dt_todas[taxa_escolarizacao %between% quantile(taxa_escolarizacao, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = taxa_escolarizacao, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F, formula = y ~ poly(x, 2)) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "Taxa de\nescolarização",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent())
plot_grid(g_pop, g_densidade_demografica, g_PIBpc, g_taxa_escolarizacao, ncol = 2)
# Obter janela ótima para modelo quadrático
### Sem covariadas
janela_outra <- rdbwselect(
x = dt_individuais$votos_razao_pp_centr,
y = dt_individuais$valor_empenhado_ipca_pc,
p = 2
)
janela_outra$bws
### Com covariadas
covariadas <- dt_individuais[, .(pop, densidade_demografica, PIBpc, taxa_escolarizacao)]
janela <- rdbwselect(
x = dt_individuais$votos_razao_pp_centr,
y = dt_individuais$valor_empenhado_ipca_pc,
p = 2,
covs = covariadas
)
janela$bws
# Filtrar base de dados para municípios cuja margem de vitória do PP está na janela
dt_todas <- dt_todas[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
dt_individuais <- dt_individuais[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
dt_bancada <- dt_bancada[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
dt_relator <- dt_relator[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
# Ver quantos municípios com eleições acirradas receberam emendas
writeLines(paste0(
"Quantidade de municípios com eleições acirradas: ",
nrow(dt_todas),
"\nQuantidade de municípios com eleições acirradas que receberam emendas: ",
nrow(dt_todas[valor_empenhado_ipca != 0]),
"\nQuantidade de municípios com eleições acirradas que receberam emendas individuais: ",
nrow(dt_individuais[valor_empenhado_ipca != 0]),
"\nQuantidade de municípios com eleições acirradas que receberam emendas de bancada: ",
nrow(dt_bancada[valor_empenhado_ipca != 0]),
"\nQuantidade de municípios com eleições acirradas que receberam emendas de relator: ",
nrow(dt_relator[valor_empenhado_ipca != 0])))
# Duas regressões quadráticas com controles de município
regs_quad_controles <- lm_robust(valor_empenhado_ipca_pc ~ vitoria_pp*votos_razao_pp_centr + vitoria_pp*votos_razao_pp_centr_sq + regiao + pop + densidade_demografica + PIBpc + taxa_escolarizacao, data = dt_individuais)
#| label: grafico_valor_empenhado_por_razao_votos_pp_quad_com_controles
# Resultados - Todos
nomes_variaveis <- c(
"votos_razao_pp_centr_sq" = "Margem de vitória do PP ao quadrado",
"votos_razao_pp_centr" = "Margem de vitória do PP",
"vitoria_pp" = "Prefeito do PP"
)
gm <- tibble::tribble(
~raw, ~clean, ~fmt, ~omit,
"nobs", "Número de observações", 0, FALSE
)
linhas_adicionais <- tribble(~variavel, ~linear_controles, ~linear, ~quad_controles,
'Janela da margem de vitória do PP', '±8,4%', '±10,7%', '±14,5%',
'Forma funcional', "Linear", "Linear", "Quadrático",
'Controles municipais', "Sim", "Não", "Sim")
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
coef_omit = 4:11,
gof_map = gm,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais,
output = "Resultados/ValorEmpenhadoPerCapitaIndividuais.png"
)
#| label: grafico_valor_empenhado_por_razao_votos_pp_linear_sem_controles
dt_todas[taxa_escolarizacao %between% quantile(taxa_escolarizacao, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = taxa_escolarizacao, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F, formula = y ~ x) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "Taxa de\nescolarização",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent())
#| label: grafico_valor_empenhado_por_razao_votos_pp_linear_sem_controles
dt_todas[valor_empenhado_ipca_pc %between% quantile(valor_empenhado_ipca_pc, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = valor_empenhado_ipca_pc, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F, formula = y ~ x) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "Taxa de\nescolarização",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent())
