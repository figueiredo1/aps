y = "População",
x = "Prefeito do PP?")
g2 <- medias_municipios_eleicoes %>%
ggplot(aes(y = media_densidade_demografica, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Densidade\ndemográfica",
x = "Prefeito do PP?")
g3 <- medias_municipios_eleicoes %>%
ggplot(aes(y = media_PIBpc, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "PIB per capita",
x = "Prefeito do PP?")
g4 <- medias_municipios_eleicoes %>%
ggplot(aes(y = media_taxa_escolarizacao, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Taxa de escolarização",
x = "Prefeito do PP?")
g5 <- medias_municipios_eleicoes %>%
ggplot(aes(y = media_mortalidade_infantil, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Mortalidade infantil",
x = "Prefeito do PP?")
graficos <- plot_grid(g1, g2, g3, g4, g5)
# plot_grid(graficos, ncol = 1, rel_heights = c(0.15, 1))
graficos
rm(medias_municipios_eleicoes, titulo, graficos, g1, g2, g3, g4, g5)
# Mostrar quais diferenças são estatisticamente significantes - fazer teste de comparação des
#| label: grafico_barras_medianas_caracteristicas_municipais_linear_sem_controles
# Criar dt com medianas
medianas_municipios_eleicoes <- dt_municipios_eleicoes[
,
.(
mediana_pop = median(pop),
mediana_densidade_demografica = median(densidade_demografica),
mediana_PIBpc = median(PIBpc),
mediana_taxa_escolarizacao = median(taxa_escolarizacao),
mediana_mortalidade_infantil = median(mortalidade_infantil, na.rm = T)
),
by = vitoria_pp
]
# Plotar medianas de quem venceu vs. não venceu - formatar
titulo <- ggplot() +
labs(title = "Comparação das medianas de características municipais", subtitle = "Fontes dos dados: TSE (2021), IBGE (2021, 2022). Elaboração própria.") +
theme_minimal()
g1 <- medianas_municipios_eleicoes %>%
ggplot(aes(y = mediana_pop, x = as.factor(vitoria_pp), data = )) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "População",
x = "Prefeito do PP?")
g2 <- medianas_municipios_eleicoes %>%
ggplot(aes(y = mediana_densidade_demografica, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Densidade\ndemográfica",
x = "Prefeito do PP?")
g3 <- medianas_municipios_eleicoes %>%
ggplot(aes(y = mediana_PIBpc, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "PIB per capita",
x = "Prefeito do PP?")
g4 <- medianas_municipios_eleicoes %>%
ggplot(aes(y = mediana_taxa_escolarizacao, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Taxa de escolarização",
x = "Prefeito do PP?")
g5 <- medianas_municipios_eleicoes %>%
ggplot(aes(y = mediana_mortalidade_infantil, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Mortalidade infantil",
x = "Prefeito do PP?")
graficos <- plot_grid(g1, g2, g3, g4, g5)
# plot_grid(titulo, graficos, ncol = 1, rel_heights = c(0.15, 1))
graficos
rm(medianas_municipios_eleicoes, titulo, graficos, g1, g2, g3, g4, g5)
#| label: grafico_barras_medias_emendas_parlamentares_linear_sem_controles
medias_valor_empenhado_ipca_pc <- dt_individuais[, .(media_empenho = mean(valor_empenhado_ipca_pc)), by = vitoria_pp]
medias_valor_empenhado_ipca_pc[vitoria_pp == 1, media_empenho] - medias_valor_empenhado_ipca_pc[vitoria_pp == 0, media_empenho]
# Duas regressões lineares sem controles de município
regs_lineares <- lm_robust(valor_empenhado_ipca_pc ~ vitoria_pp*votos_razao_pp_centr, data = dt_individuais)
#| label: grafico_caracteristicas_municipais_por_razao_votos_pp_quad
# Recuperação das versões completas das bases de dados
# Guardar bases de dados completas
dt_todas <- dt_todas_completa
dt_individuais <- dt_individuais_completa
dt_bancada <- dt_bancada_completa
dt_relator <- dt_relator_completa
# Linear
g_pop <- dt_todas[pop %between% quantile(pop, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = pop, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F, formula = y ~ poly(x, 2)) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0.5, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "População",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent()) + scale_x_continuous(labels = label_percent())
g_densidade_demografica <- dt_todas[densidade_demografica %between% quantile(densidade_demografica, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = densidade_demografica, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F, formula = y ~ poly(x, 2)) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0.5, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "Densidade\ndemográfica",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent())
g_PIBpc <- dt_todas[PIBpc %between% quantile(PIBpc, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = PIBpc, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F, formula = y ~ poly(x, 2)) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0.5, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "PIB per capita",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent())
g_taxa_escolarizacao <- dt_todas[taxa_escolarizacao %between% quantile(taxa_escolarizacao, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = taxa_escolarizacao, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, size = 0.5, color = "black") +
stat_smooth(method = "lm", se = F, formula = y ~ poly(x, 2)) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0.5, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "Taxa de\nescolarização",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent())
plot_grid(g_pop, g_densidade_demografica, g_PIBpc, g_taxa_escolarizacao, ncol = 2)
#| label: grafico_valor_empenhado_por_razao_votos_pp_quad
# Linear
dt_individuais[valor_empenhado_ipca_pc %between% quantile(valor_empenhado_ipca_pc, c(.02, .99), na.rm = TRUE)] %>%
ggplot(aes(x = votos_razao_pp_centr, y = valor_empenhado_ipca_pc, color = as.factor(vitoria_pp))) +
geom_point(shape = 21, color = "black") +
stat_smooth(method = "lm", se = F, formula = y ~ poly(x, 2)) +
scale_color_brewer(palette = "Dark2", direction = -1) +
geom_vline(xintercept = 0.5, linetype = "dashed") +
scale_y_continuous(labels = label_number()) +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "Valor empenhado per capita",
x = "Margem de vitória do PP") + scale_x_continuous(labels = label_percent())
# Obter janela ótima para modelo quadrático
### Sem covariadas
janela_outra <- rdbwselect(
x = dt_individuais$votos_razao_pp_centr,
y = dt_individuais$valor_empenhado_ipca_pc,
p = 2
)
janela_outra$bws
### Com covariadas
covariadas <- dt_individuais[, .(pop, densidade_demografica, PIBpc, taxa_escolarizacao)]
janela <- rdbwselect(
x = dt_individuais$votos_razao_pp_centr,
y = dt_individuais$valor_empenhado_ipca_pc,
p = 2,
covs = covariadas
)
janela$bws
# Filtrar base de dados para municípios cuja margem de vitória do PP está na janela
dt_todas <- dt_todas[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
dt_individuais <- dt_individuais[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
dt_bancada <- dt_bancada[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
dt_relator <- dt_relator[votos_razao_pp_centr >= -janela$bws[1] &
votos_razao_pp_centr <= janela$bws[1]]
# Ver quantos municípios com eleições acirradas receberam emendas
writeLines(paste0(
"Quantidade de municípios com eleições acirradas: ",
nrow(dt_todas),
"\nQuantidade de municípios com eleições acirradas que receberam emendas: ",
nrow(dt_todas[valor_empenhado_ipca != 0]),
"\nQuantidade de municípios com eleições acirradas que receberam emendas individuais: ",
nrow(dt_individuais[valor_empenhado_ipca != 0]),
"\nQuantidade de municípios com eleições acirradas que receberam emendas de bancada: ",
nrow(dt_bancada[valor_empenhado_ipca != 0]),
"\nQuantidade de municípios com eleições acirradas que receberam emendas de relator: ",
nrow(dt_relator[valor_empenhado_ipca != 0])))
#| label: grafico_barras_medias_caracteristicas_municipais_quad
# Criar dt com médias
medias_municipios_eleicoes <- dt_municipios_eleicoes[
,
.(
media_pop = mean(pop),
media_densidade_demografica = mean(densidade_demografica),
media_PIBpc = mean(PIBpc),
media_taxa_escolarizacao = mean(taxa_escolarizacao),
media_mortalidade_infantil = mean(mortalidade_infantil, na.rm = T)
),
by = vitoria_pp
]
# Plotar médias de quem venceu vs. não venceu - formatar
titulo <- ggplot() +
labs(title = "Comparação das médias de características municipais", subtitle = "Fontes dos dados: TSE, IBGE (2021, 2022). Elaboração própria.") +
theme_minimal()
g1 <- medias_municipios_eleicoes %>%
ggplot(aes(y = media_pop, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() + guides(color = "none") +
labs(title = "",
y = "População",
x = "Prefeito do PP?")
g2 <- medias_municipios_eleicoes %>%
ggplot(aes(y = media_densidade_demografica, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Densidade\ndemográfica",
x = "Prefeito do PP?")
g3 <- medias_municipios_eleicoes %>%
ggplot(aes(y = media_PIBpc, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "PIB per capita",
x = "Prefeito do PP?")
g4 <- medias_municipios_eleicoes %>%
ggplot(aes(y = media_taxa_escolarizacao, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Taxa de escolarização",
x = "Prefeito do PP?")
g5 <- medias_municipios_eleicoes %>%
ggplot(aes(y = media_mortalidade_infantil, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Mortalidade infantil",
x = "Prefeito do PP?")
graficos <- plot_grid(g1, g2, g3, g4, g5)
# plot_grid(graficos, ncol = 1, rel_heights = c(0.15, 1))
graficos
rm(medias_municipios_eleicoes, titulo, graficos, g1, g2, g3, g4, g5)
# Mostrar quais diferenças são estatisticamente significantes - fazer teste de comparação des
#| label: grafico_barras_medianas_caracteristicas_municipais_quad
# Criar dt com medianas
medianas_municipios_eleicoes <- dt_municipios_eleicoes[
,
.(
mediana_pop = median(pop),
mediana_densidade_demografica = median(densidade_demografica),
mediana_PIBpc = median(PIBpc),
mediana_taxa_escolarizacao = median(taxa_escolarizacao),
mediana_mortalidade_infantil = median(mortalidade_infantil, na.rm = T)
),
by = vitoria_pp
]
# Plotar medianas de quem venceu vs. não venceu - formatar
titulo <- ggplot() +
labs(title = "Comparação das medianas de características municipais", subtitle = "Fontes dos dados: TSE (2021), IBGE (2021, 2022). Elaboração própria.") +
theme_minimal()
g1 <- medianas_municipios_eleicoes %>%
ggplot(aes(y = mediana_pop, x = as.factor(vitoria_pp), data = )) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "População",
x = "Prefeito do PP?")
g2 <- medianas_municipios_eleicoes %>%
ggplot(aes(y = mediana_densidade_demografica, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Densidade\ndemográfica",
x = "Prefeito do PP?")
g3 <- medianas_municipios_eleicoes %>%
ggplot(aes(y = mediana_PIBpc, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "PIB per capita",
x = "Prefeito do PP?")
g4 <- medianas_municipios_eleicoes %>%
ggplot(aes(y = mediana_taxa_escolarizacao, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Taxa de escolarização",
x = "Prefeito do PP?")
g5 <- medianas_municipios_eleicoes %>%
ggplot(aes(y = mediana_mortalidade_infantil, x = as.factor(vitoria_pp))) +
geom_col() +
theme_minimal() +
labs(title = "",
y = "Mortalidade infantil",
x = "Prefeito do PP?")
graficos <- plot_grid(g1, g2, g3, g4, g5)
# plot_grid(titulo, graficos, ncol = 1, rel_heights = c(0.15, 1))
graficos
rm(medianas_municipios_eleicoes, titulo, graficos, g1, g2, g3, g4, g5)
#| label: grafico_barras_medias_emendas_parlamentares_quad
medias_valor_empenhado_ipca_pc <- dt_individuais[, .(media_empenho = mean(valor_empenhado_ipca_pc)), by = vitoria_pp]
medias_valor_empenhado_ipca_pc[vitoria_pp == 1, media_empenho] - medias_valor_empenhado_ipca_pc[vitoria_pp == 0, media_empenho]
# Duas regressões quadráticas com controles de município
regs_quad_controles <- lm_robust(valor_empenhado_ipca_pc ~ vitoria_pp*votos_razao_pp_centr + vitoria_pp*votos_razao_pp_centr_sq + regiao + pop + densidade_demografica + PIBpc + taxa_escolarizacao, data = dt_individuais)
# Resultados - Quadrático
nomes_variaveis <- c(
"votos_razao_pp_centr_sq" = "Margem de vitória do PP ao quadrado",
"votos_razao_pp_centr" = "Margem de vitória do PP",
"vitoria_pp" = "Prefeito do PP"
)
linhas_adicionais <- tribble(~variavel, ~linear_controles, ~linear, ~quad_controles,
'Forma funcional', "Linear", "Linear", "Quadrático",
'Controles municipais', "Sim", "Não", "Sim",
'Janela da margem de vitória do PP', '±8,4%', '±10,7%', '±14,5%')
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais,
output = "Resultados/ValorEmpenhadoPerCapitaIndividuais.png"
)
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
coef_omit = 3:10,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
coef_omit = 3:10,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
coef_omit = 4:10,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
coef_omit = 4:11,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
coef_omit = 4:11,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
# Resultados - Quadrático
nomes_variaveis <- c(
"votos_razao_pp_centr_sq" = "Margem de vitória do PP ao quadrado",
"votos_razao_pp_centr" = "Margem de vitória do PP",
"vitoria_pp" = "Prefeito do PP",
"Num.Obs." = "N"
)
linhas_adicionais <- tribble(~variavel, ~linear_controles, ~linear, ~quad_controles,
'Forma funcional', "Linear", "Linear", "Quadrático",
'Controles municipais', "Sim", "Não", "Sim",
'Janela da margem de vitória do PP', '±8,4%', '±10,7%', '±14,5%')
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
coef_omit = 4:11,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
# Resultados - Quadrático
nomes_variaveis <- c(
"votos_razao_pp_centr_sq" = "Margem de vitória do PP ao quadrado",
"votos_razao_pp_centr" = "Margem de vitória do PP",
"vitoria_pp" = "Prefeito do PP",
"Num.Obs." = "N"
)
linhas_adicionais <- tribble(~variavel, ~linear_controles, ~linear, ~quad_controles,
'Forma funcional', "Linear", "Linear", "Quadrático",
'Controles municipais', "Sim", "Não", "Sim",
'Janela da margem de vitória do PP', '±8,4%', '±10,7%', '±14,5%')
modelsummary(list(
"Linear com controles" = regs_lineares_controles,
"Linear sem controles" = regs_lineares,
"Quadrático com controles" = regs_quad_controles
),
statistic = NULL,
stars = T,
coef_omit = 4:11,
gof_omit = "R2|AIC|BIC|RMSE",
coef_rename = nomes_variaveis,
add_rows = linhas_adicionais
)
